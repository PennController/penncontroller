!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=27)}({27:function(e,t){window.PennController._AddElementType("EyeTracker",(function(e){let t,i,o,s=!1,r=!1,A=[[],[]],a=!1,l=null,c=null,u="",d=!1;window.PennController.EyeTrackerURL=e=>u=e;const h=new Audio("data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");function p(e){for(var t,n={},i=(e+"").split(""),o=[],s=i[0],r=256,A=1;A<i.length;A++)null!=n[s+(t=i[A])]?s+=t:(o.push(s.length>1?n[s]:s.charCodeAt(0)),n[s+t]=r,r++,s=t);o.push(s.length>1?n[s]:s.charCodeAt(0));for(A=0;A<o.length;A++)o[A]=String.fromCharCode(o[A]);return o.join("")}function g(){if(window.webgazer&&t)return window.webgazer;e.debug.error("Tried to access the EyeTracker before it was set.")}function m(e){e=!(!1===e),g().showFaceFeedbackBox(e),g().showFaceOverlay(e),g().showPredictionPoints(e),g().showVideo(e),$("#webgazerGazeDot").css("pointer-events","none")}function f(e){let t=window.innerHeight,i=window.innerWidth,o=e[0],s=e[1],r=i/2,A=t/2,a=new Array(50);!function(e,t,i,o,s,r){for(n=0;n<50;n++){let A=s-i[n],a=r-o[n],l=Math.sqrt(A*A+a*a),c=t/2,u=0;u=l<=c?100-l/c*100:0,e[n]=u}}(a,t,o,s,r,A);let l=function(e){let t=0;for(n=0;n<50;n++)t+=e[n];return t/=50,t}(a);return Math.round(l)}const w=(e,t)=>{d=!0,r&&(A[0].push(e.x),A[1].push(e.y),A[0].length>50&&A[0].shift(),A[1].length>50&&A[1].shift()),i&&i.look(e,t)};let b=function(){o=e.utils.guidGenerator(),s=!0;let n=document.createElement("script");n.setAttribute("src","https://cdn.jsdelivr.net/gh/penncontroller/penncontroller/releases/latest/webgazer.min.js"),document.head.appendChild(n);let i=()=>{window.webgazer?function(){A=[[],[]],t=window.webgazer.setRegression("weightedRidge").setTracker("TFFacemesh").setGazeListener((e,t)=>{null!=e&&(e instanceof Promise?e.then(e=>w(e,t)):e.x&&w(e,t))});let e=document.addEventListener;document.addEventListener=function(...t){"mousemove"!=t[0]||"function"!=typeof t[1]||!0!==t[2]||l||(l=t[1]),"click"!=t[0]||"function"!=typeof t[1]||!0!==t[2]||c||(c=t[1]),e.apply(document,t)},t.params.showVideoPreview=!0,t.begin(),window.webgazer.showPredictionPoints(!0),m(!1)}():setTimeout(i,100)};void 0===t&&i()};this.immediate=function(e,t,n){s||b(),"number"==typeof e&&(void 0===t||"number"==typeof t&&void 0===n)&&(n=t,t=e,void 0!==e&&"string"==typeof e&&0!=e.length||(e="EyeTracker"),this.id=e),this.span=Number(t),this.proportion=n},this.uponCreation=function(t){let n;this.enabled=!1,this.elements=[],this.counts={times:[]},this.callback=null,this.log=!1,this.trainOnMouseMove=!0,this.look=function(t,i){if(this.enabled&&null!=t&&void 0!==t.x&&void 0!==t.y){this.elements.map(e=>e.jQueryElement.removeClass("PennController-eyetracked"));for(let n=0;n<this.elements.length;n++){const i=this.elements[n].jQueryElement,o=e.utils.overToScale.call(i,t.x,t.y);if(o?this.counts["_"+this.elements[n].id].push(1):this.counts["_"+this.elements[n].id].push(0),isNaN(this.span))o&&(i.addClass("PennController-eyetracked"),this.callback&&this.callback instanceof Function&&this.callback.call(this.elements[n],t.x,t.y));else{this.hasOwnProperty("gazes")&&this.elements.length==this.gazes.length||(this.gazes=this.elements.map(()=>[])),o?this.gazes[n].push(!0):this.gazes[n].push(!1),this.gazes[n].length>this.span&&this.gazes[n].shift();let e=Number(this.proportion);isNaN(e)&&(e=this.span/100),e<=0?e=.01:e>=1&&(e=.99),this.gazes[n].filter(e=>e).length/this.gazes[n].length>e&&i.addClass("PennController-eyetracked"),this.callback&&this.callback instanceof Function&&this.callback.call(this.elements[n],t.x,t.y)}}void 0===n&&(n=i),this.counts.times.push(Math.round(i-n)),n=i}},t()},this.end=function(){if(m(!1),g().removeMouseEventListeners(),this.enabled=!1,i=void 0,this.log&&this.counts.times.length){let t=u,n=window.location.href.replace(/[^/]+$/,"").replace(/[^\w\d]/g,"").replace(/[\.]{2,}/g,"");e.debug.log("expname",n);let i=(i,s)=>{let r={experiment:n,id:o,pcnumber:e.controllers.running.id,parameter:i,value:s},A="json="+JSON.stringify(r);var a=new XMLHttpRequest;a.open("POST",t,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.onreadystatechange=()=>{200!=a.status&&e.controllers.running.save(this.type,this.id,"Upload","Error",Date.now(),i)},a.send(A)};e.debug.log("about to send times",this.counts),i("times",p(this.counts.times.join("."))),delete this.counts.times;let s=Object.keys(this.counts);for(let e=0;e<s.length;e++)i(s[e],p(this.counts[s[e]].join(".")));e.controllers.running.save(this.type,this.id,"Filename",n+"/"+o,Date.now(),"NULL")}delete this.counts},this.value=function(){return"EyeTracker"},this.actions={calibrate(t,n,i){Number(i)>0||(i=-1),function t(n,i,o,s){g().addMouseEventListeners(),e.debug.log("Starting calibration"),A=[[],[]];let l=$("<div>").css({position:"absolute",left:0,top:0,width:"100vw",height:"100vh","background-color":"white","text-align":"center"}),u=async()=>{await new Promise(e=>setTimeout(e,1e3));const u=$("<div>").css({position:"fixed",display:"block",width:"48px",height:"48px",background:"green","border-radius":"100%",left:"calc(50vw - 24px)",top:"calc(50vh - 24px)","z-index":999999});$("body").append(u),c({clientX:window.innerWidth/2,clientY:window.innerHeight/2}),$(this).attr("disabled",!0),r=!0,setTimeout(()=>{r=!1,u.detach();let c=f(A);i._precision=c,e.debug.log("Tracker's precision: "+c),A=[[],[]],e.controllers.running.save(i.type,i.id,"calibration",c,Date.now(),1==s?"Last attempt":"NULL"),o&&Number(o)>0&&c<o&&1!=s?(a=!1,$(this).remove(),m(!0),l.append($("<div>").html("<p>It looks like we were not able to precisely calibrate the tracker:</p><p>You calibration score is "+c+" and you need at least "+o+"</p><p>Here are a few tips to help you better self-calibrate:</p><p>- try adjusting your webcam based on the video in the top-left corner.</p><p>- if you use an external webcam, make sure it is fixed to the top of your screen.</p><p>- try raising your screen so as to align your webcam with your eyes</p><p><img style='display: inline-block; height: 75px;' src='http://files.lab.florianschwarz.net/ibexfiles/Pictures/lookdown.png'><img style='display: inline-block; height: 75px;' src='http://files.lab.florianschwarz.net/ibexfiles/Pictures/lookstraight.png'></p><p>- make sure no one is standing next to you.</p><p>- make sure you are not wearing eyeglasses reflecting ambiant light.</p><p>- make sure the algorithm detects your face (it should appear green).</p><p>- make sure there is enough ambient light for face-detection.</p><p>- make sure you follow your mouse pointer with your eyes.</p><p>- make sure you keep looking at the middle button until the end.</p>").css({margin:"auto","margin-top":"5em"})).append($("<button>Retry</button>").click((function(){l.remove(),window.webgazer.reg.RidgeWeightedReg.call(window.webgazer.getRegression()[0]),t(n,i,o,s-1)})).css("margin","auto"))):(a=!0,l.remove(),g().removeMouseEventListeners(),n())},3e3)};if(a)u();else{m(!0);const e=48,t=48,n=120;let i=[];const o=async s=>{const r=i.shift(),A=$("<div>").css({position:"fixed",display:"block",width:e+"px",height:t+"px",background:"green","border-radius":"100%",left:r[0],top:r[1],"z-index":999999});await new Promise(e=>setTimeout(e,750)),$("body").append(A),h.play(),await new Promise(e=>setTimeout(e,250));let a=n;const l=()=>{a%2&&c({clientX:r[0]+e/2,clientY:r[1]+t/2}),0==a?(A.detach(),i.length?o():u()):(a--,window.requestAnimationFrame(l))};l()},s=()=>$("body").append($("<button>I'm ready. Start calibration</button>").bind("click",n=>{g().removeMouseEventListeners(),m(!1),$(n.target).detach();const s=window.innerWidth,r=window.innerHeight;i=[[(s-e)/2,(r-t)/2],...[[0,0],[(s-e)/2,0],[s-e,r-t],[(s-e)/2,r-t],[s-e,(r-t)/2],[s-e,0],[0,(r-t)/2],[0,r-t]].sort(e=>.5-Math.random()),[(s-e)/2,(r-t)/2]],o()}).css({position:"fixed",display:"block",left:"50vw",top:"50vh",transform:"translate(-50%,-50%)"}));if(d)s();else{const e=$("<p>Wait until your face is detected (you should see green contours around it)                                    and then click anywhere on the page until you see a red dot</p>");e.css({position:"fixed",left:"50vw",top:"50vh",transform:"translate(-50%,-50%)"}),$("body").append(e);const t=()=>{d?(e.remove(),s()):window.requestAnimationFrame(t)};t()}}$("#webgazerVideoFeed").before(l)}(t,this,n,i)},hideFeedback:function(e){m(!1),e()},start:function(e){this.enabled=!0,i=this,e()},stop:function(e){this.enabled=!1,i=void 0,e()},stopTraining:function(e){g().removeMouseEventListeners(),g().showPredictionPoints(!1),e()},showFeedback:function(e){m(),e()},train:function(e,t){g().addMouseEventListeners(),this.trainOnMouseMove||document.removeEventListener("mousemove",l,!0),g().showPredictionPoints(t),e()}},this.settings={add:function(e,...t){for(let e=0;e<t.length;e++){let n=t[e];n&&n._element&&this.elements.indexOf(n._element)<0&&(this.elements.push(n._element),this.counts["_"+n._element.id]=[])}e()},callback:function(e,t){t instanceof Function&&(this.callback=t),e()},log:function(e){this.log=!0,e()},trainOnMouseMove:function(e,t){this.trainOnMouseMove=void 0===t||t,this.trainOnMouseMove||document.removeEventListener("mousemove",l,!0),e()}},this.test={calibrated:function(){return a},ready:function(){return window.webgazer&&window.webgazer.isReady()},score:function(e){const t=this._precision;return e instanceof Function?e.call(this,t):isNaN(Number(e))?a:t>=Number(e)}}}))}});